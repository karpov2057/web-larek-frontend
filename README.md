# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с настройками запроса.\
Поля класса:
- baseUrl: string — базовый URL
- options: RequestInit — объект с настройками запроса.

Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
- `handleResponse` - проверяет, является ли запрос успешным, если да возвращает промис.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - устанавливает обработчик на событие
- `off` - cнимает обработчик с события
- `emit` - инициализация события
- `onAll` - слушатель всех событий
- `offAll` - сброс всех обработчиков
- `trigger` - коллбек триггер, генерирующий событие при вызове

### Слой данных

#### Класс ProductsData
Класс отвечает за хранение и логику работы с данными товаров.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- product: IProducts[] - массив объектов товаров
- preview: string | null - id товара, выбранной для просмотра в модальной окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий.

### Классы представления
Классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.  
- constructor(selector: string, events: IEvents) Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- closeButton: HTMLButtonElement - элемент закрытия модального окна
- content: HTMLElement - элемент для контента

#### Класс ProductList
Предназначен для реализации выведения списка товаров и модального окна товара.
Поля класса:
  productsData: ProductsData;
  private api: IProductAPI;
  private modal: Modal;
  private events: IEvents;
  private basket: Basket;

Методы:
- renderProducts(products: IProduct[]) - отрисовка списка продуктов
- createProductItem(product: IProduct) - создаёт разметку карточки продукта
- showProductInModal(product: IProduct) - подготовку модального окна и его содержимого

#### Класс Basket
Предназначен для реализации модального окна корзины с товарами.
Поля класса:
- items: (id: string, price: number) - товар 
- arrangeButton: HTMLButtonElement - кнопка оформления заказа

Методы:
- addProduct(product: IProduct) - добавление товара
- removeProduct(productId: string) - удаление товара из корзины
- isProductInBasket(productId: string) - проверяет, находится ли товар с указанным ID в корзине
- clear(): void - очищает корзину
- calculateTotalPrice(): number - рассчитывает общую стоимость всех товаров в корзине
- updateTotalPrice(): void - обновляет информацию об общей стоимости корзины на интерфейсе
- updateBasket(): void - обновляет счетчик количества товаров в корзине
- openBasket(): void - открывает модальное окно корзины с текущим списком товаров
- renderBasket(): void - перерисовывает содержимое корзины

#### Класс DeliveryАddressModal
Расширяет класс Modal. Предназначен для реализации модального окна адреса доставки.
Поля класса:
- form: HTMLFormElement - элемент формы
- formName: string - значение атрибута name формы
- nextButton: HTMLButtonElement - кнопка "Далее"
- paymentMethod: string | null - выбранный способ оплаты
- currentOrder: Partial - объект с текущими данными заказа

Методы:
- setPaymentMethod() - устанавливает выбранный способ оплаты
- validateForm(): boolean - проверяет корректность заполнения формы
- updateNextButtonState(): void - обновляет состояние кнопки "Далее"
- initEvents(): void - регистрирует обработчики событий

#### Класс UserInfoModal
Расширяет класс Modal. Предназначен для реализации модального окна адреса доставки.
Поля класса:
- form: HTMLFormElement - элемент формы
- formName: string - значение атрибута name формы
- paymentButton: HTMLButtonElement - кнопка оплаты заказа

Методы:
- validateForm(): boolean - проверяет корректность заполнения формы
- initEvents(): void - регистрирует обработчики событий

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.
